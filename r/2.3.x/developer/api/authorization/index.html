<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Authorization - Opencast - Developer Guide</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/font-awesome.min.css" rel="stylesheet">
  <link href="../../css/style-guide.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Authorization";
    var mkdocs_page_input_path = "api/authorization.md";
    var mkdocs_page_url = "/api/authorization/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Opencast - Developer Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development Process</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../development-process/">Development</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reviewing-and-merging/">Reviewing, Merging and Declining Pull Requests</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release-manager/">Release Manager</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Decision Making</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../decision-making/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/lazy-consensus/">Lazy Consensus</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/consensus-building/">Consensus Building</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/voting/">Voting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../development-environment/">Development Environment</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../license/">Licenses and Legal Matters</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../localization/">Localization</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../packaging/">Packaging</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../proposal-log/">Proposal Log</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Modules</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../modules/">Overview</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Admin UI</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/admin-ui/development/">Development</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Style Guide</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/color-palette/">Color Palette</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/typeface/">Typeface</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/view-structure/">View Structure</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/spacing/">Logo</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/navigation/">Navigation</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/modals/">Modals</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/forms/">Forms</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/icons/">Icons</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/buttons/">Buttons</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/dropdowns/">Dropdowns</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/alerts-indicators/">Alerts and Indicators</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/references/">References</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Player</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/architecture/">Architecture</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/core.reference/">Core Reference</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/events/">Events</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/storage/">Storage</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/plugin.development/">Plugin Development</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/testing/">Testing</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/stream-security/">Stream Security</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Infrastructure</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../infrastructure/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../infrastructure/notes/">Notes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../infrastructure/nexus/">Nexus Maven Repository</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../usage/">Usage</a>
                </li>
                <li class="">
                    
    <a class="" href="../authentication/">Authentication</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Authorization</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
    

    <li class="toctree-l3"><a href="#delegation-of-authorization">Delegation of Authorization</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#user-switching">User switching</a></li>
        
            <li><a class="toctree-l4" href="#role-switching">Role switching</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#best-practice">Best practice</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#one-user-per-external-application">One user per external application</a></li>
        
            <li><a class="toctree-l4" href="#preference-for-user-and-role-switching">Preference for user and role switching</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#access-control">Access Control</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#roles">Roles</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../glossary/">Glossary</a>
                </li>
                <li class="">
                    
    <a class="" href="../base-api/">Base API</a>
                </li>
                <li class="">
                    
    <a class="" href="../events-api/">Events API</a>
                </li>
                <li class="">
                    
    <a class="" href="../series-api/">Series API</a>
                </li>
                <li class="">
                    
    <a class="" href="../groups-api/">Groups API</a>
                </li>
                <li class="">
                    
    <a class="" href="../security-api/">Security API</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Opencast - Developer Guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>API &raquo;</li>
        
      
    
    <li>Authorization</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://bitbucket.org/opencast-community/matterhorn/src/develop/docs/guides/developer/docs/src/default/docs/api/authorization.md"
          class="icon icon-bitbucket"
        > Edit on Bitbucket</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="introduction">Introduction</h1>
<p>The Application API can be accessed in two different ways: Either using a single dedicated user with access to everything (“super user”) or by implementing more fine grained access through user and role switching upon every request (“user switching” or “sudo” execution mode), where the request is executed in the name and using the roles of the specified user.</p>
<p>The first method is ideal for scenarios where the end users of the external application are not managed in Opencast. The downside of this approach is a potential security risk as well as the inability to audit and track changes made by the external applications back to the actual user who actually triggered the changes. The second method is more cumbersome to implement but leads a much improved control and assessment of security.</p>
<h1 id="delegation-of-authorization">Delegation of Authorization</h1>
<p>In situations where the provider of the API offers a super user who is allowed “sudo” requests that are executed on behalf of another user, the API is actually delegating authorization to the client application. In this cause authorization is performed upon login of the super user, but then the super user can switch to any other user or any set of roles (with a few exceptions for security reasons).</p>
<p>Note that in order to allow for user switching, a specific role needs to be assigned to the super user, and that role cannot be obtained by manipulating the role set (see <a href="#role-switching">Role switching</a>).</p>
<h2 id="user-switching">User switching</h2>
<p>When working with a super user, it is considered a best practice to specify a dedicated execution user upon each request whenever possible and reasonable. This way, creation or modification of resources can later be audited and mapped back to that user if needed.</p>
<p>The execution user can be specified by setting the <code>X-RUN-AS-USER</code> request header with the user name as its value, as seen in this sample request:</p>
<table>
<thead>
<tr>
<th align="left">Request</th>
<th align="left">Headers</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>GET /api</code></td>
<td align="left"><code>X-RUN-AS-USER: john.doe</code></td>
</tr>
</tbody>
</table>
<p>Switching to another user can potentially fail for various reasons: The user might not exist or may not be allowed to switch to due to potential privilege escalation, or the current user might not be allowed to switch users at all.</p>
<p>If the request to switch to another user fails, the following response codes are returned:</p>
<table>
<thead>
<tr>
<th align="left">Response code</th>
<th align="left">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>403 (FORBIDDEN)</code></td>
<td align="left">The current user is not allowed to switch users</td>
</tr>
<tr>
<td align="left"><code>403 (FORBIDDEN)</code></td>
<td align="left">The user cannot be switched to due to potential escalation of privileges</td>
</tr>
<tr>
<td align="left"><code>412 Precondition failed</code></td>
<td align="left">The user specified in the X-RUN-AS-USER header does not exist</td>
</tr>
</tbody>
</table>
<h2 id="role-switching">Role switching</h2>
<p>Rather than specifying an execution user, the client might choose to specify a set of roles that should be used when executing the request. This technique is recommended in cases where the users are not managed by the API. By specifying a set of roles, the corresponding request will be executed using the API’s anonymous user but equipped with the specified set of roles.</p>
<p>The execution user’s roles can be specified by setting the <code>X-RUN-WITH-ROLES</code> request header with the set of roles as its value and with individual roles separated by comma, as seen in this sample request:</p>
<table>
<thead>
<tr>
<th align="left">Request</th>
<th align="left">Headers</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>GET /api</code></td>
<td align="left"><code>X-RUN-WITH-ROLES: ROLE_A,ROLE_B</code></td>
</tr>
</tbody>
</table>
<p>Switching to a set of roles can potentially fail for various reasons: The role may not be granted to due to potential privilege escalation, or the current user might not be allowed to switch roles at all.
If the request to apply a set of roles fails, the following response codes are returned:</p>
<table>
<thead>
<tr>
<th align="left">Response code</th>
<th align="left">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>403 (FORBIDDEN)</code></td>
<td align="left">The current user is not allowed to switch roles</td>
</tr>
<tr>
<td align="left"><code>403 (FORBIDDEN)</code></td>
<td align="left">The roles cannot be granted to due to potential escalation of privileges</td>
</tr>
</tbody>
</table>
<h1 id="best-practice">Best practice</h1>
<h2 id="one-user-per-external-application">One user per external application</h2>
<p>As a best practice, the API provider should create one super user per external application and tenant, so that access through that super user can be controlled, limited and turned off individually for each external application and tenant.</p>
<h2 id="preference-for-user-and-role-switching">Preference for user and role switching</h2>
<p>Client implementations accessing the API through a super user are urged to implement and enforce user and role switching as much as possible, since it allows for auditing of user activity on the API and introduces less risk by running requests with a limited set of privileges.</p>
<p>Obviously, if all requests are executed using the super user directly, it is not possible to track which user initiated a given action.</p>
<h1 id="access-control">Access Control</h1>
<p>Most events in Opencast come with an access control list (ACL), containing entries that map actions to roles, either allowing or denying that action. Opencast currently only supports the ability to explicitly allow an action and consider everything else to be denied.</p>
<h2 id="roles">Roles</h2>
<p>When a user authenticates against Opencast, it is assigned its set of roles that determine the user's access to Opencast data entities. There are multiple ways to associate roles with a user:</p>
<ol>
<li>Explicit assignment directly to the user</li>
<li>Directly through membership in groups (ROLE_GROUP_&lt;group name&gt;)</li>
<li>Indirectly through membership in groups (whatever roles have been assigned to the group)</li>
</ol>
<p>In addition, a special role is assigned that uniquely identifies a user ("user role"). This role is formed like <code>ROLE_USER_&lt;user login&gt;</code> and can be determined by evaluating the <code>role</code> attribute in the Base API's call to <a href="../../base-api/#get-apiinfome">/info/me</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../glossary/" class="btn btn-neutral float-right" title="Glossary">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../authentication/" class="btn btn-neutral" title="Authentication"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://bitbucket.org/opencast-community/matterhorn/src/develop/docs/guides/developer/docs" class="icon icon-bitbucket" style="float: left; color: #fcfcfc"> BitBucket</a>
      
      
        <span><a href="../authentication/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../glossary/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
