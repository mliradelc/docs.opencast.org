<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Maven Repository - Opencast - Developer Guide</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/font-awesome.min.css" rel="stylesheet">
  <link href="../../css/style-guide.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Maven Repository";
    var mkdocs_page_input_path = "infrastructure/maven-repository.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Opencast - Developer Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development Process</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../development-process/">Development</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reviewing-and-merging/">Reviewing, Merging and Declining Pull Requests</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release-manager/">Release Manager</a>
                </li>
                <li class="">
                    
    <a class="" href="../../qa-coordinator/">QA Coordinator</a>
                </li>
                <li class="">
                    
    <a class="" href="../../security/">Security Issues</a>
                </li>
                <li class="">
                    
    <a class="" href="../../code-style/">Code Style</a>
                </li>
                <li class="">
                    
    <a class="" href="../../documentation/">Documentation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Decision Making</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../decision-making/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/lazy-consensus/">Lazy Consensus</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/consensus-building/">Consensus Building</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/voting/">Voting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development Environment</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../development-environment/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../development-environment-docker/">With Docker</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../committer/">Committers</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../license/">Licenses and Legal Matters</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../governance/">Governance</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../localization/">Localization</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../packaging/">Packaging</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../proposal-log/">Proposal Log</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../asset-manager/">Asset Manager</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../scheduler/">Scheduler</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Modules</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../modules/">Overview</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Administrative user Interface</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/admin-ui/development/">Development</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Style Guide</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/">Overview</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/color-palette/">Color Palette</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/typeface/">Typeface</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/view-structure/">View Structure</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/spacing/">Logo</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/navigation/">Navigation</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/modals/">Modals</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/forms/">Forms</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/icons/">Icons</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/buttons/">Buttons</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/dropdowns/">Dropdowns</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/alerts-indicators/">Alerts and Indicators</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/references/">References</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/capture-agent/">Capture Agent</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Player</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/architecture/">Architecture</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/core.reference/">Core Reference</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/events/">Events</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/storage/">Storage</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/plugin.development/">Plugin Development</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/testing/">Testing</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/stream-security/">Stream Security</a>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/oaipmh/">OAI-PMH</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Infrastructure</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../notes/">Notes</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Maven Repository</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#opencast-maven-repository">Opencast Maven Repository</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#adding-libraries-to-the-repository">Adding Libraries To The Repository</a></li>
        
            <li><a class="toctree-l4" href="#setting-up-another-maven-repository">Setting-up Another Maven Repository</a></li>
        
            <li><a class="toctree-l4" href="#prefer-a-specific-repository">Prefer a Specific Repository</a></li>
        
            <li><a class="toctree-l4" href="#pushing-artifacts-to-maven">Pushing artifacts to Maven</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">External API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/usage/">Usage</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/authentication/">Authentication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/authorization/">Authorization</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/base-api/">Base API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/events-api/">Events API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/series-api/">Series API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/groups-api/">Groups API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/security-api/">Security API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/types/">Data Types</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/glossary/">Glossary</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Opencast - Developer Guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Infrastructure &raquo;</li>
        
      
    
    <li>Maven Repository</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opencast/opencast/tree/develop/docs/guides/developer/docs/edit/master/docs/infrastructure/maven-repository.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="opencast-maven-repository">Opencast Maven Repository</h1>
<p>The Maven repository server maintains a copy of all the Java dependencies used by Opencast.</p>
<h2 id="adding-libraries-to-the-repository">Adding Libraries To The Repository</h2>
<ol>
<li>Login as an administrator on the <a href="https://nexus.opencast.org">Opencast Nexus Master</a></li>
<li>Select repository</li>
<li>Select the artifact upload tab</li>
<li>Fill in the details and upload the file</li>
</ol>
<h2 id="setting-up-another-maven-repository">Setting-up Another Maven Repository</h2>
<p>Having a repository server run in your local network can significantly improve the speed artifacts are retrieved while
building Opencast.</p>
<h3 id="docker">Docker</h3>
<p>There is a preconfigured Docker image for a Nexus server set-up for Opencast. To run an Opencast Nexus using Docker,
follow these steps:</p>
<pre><code>docker run \
    --name mvncache \
    -p 8000:8000 \
    docker.io/lkiesow/opencast-maven-repository
</code></pre>
<ul>
<li>The <code>-p</code> option will map the internal port of the server in Docker to the port on the host machine.</li>
</ul>
<h2 id="prefer-a-specific-repository">Prefer a Specific Repository</h2>
<p>If you did set-up a local repository or just want to select a specific global repository by default, you can use a
custom Maven configuration. To do that, create asettings file in <code>~/.m2/settings.xml</code> like this:</p>
<pre><code class="xml">&lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0
  http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt;
  &lt;mirrors&gt;
    &lt;mirror&gt;
      &lt;id&gt;opencast-osna&lt;/id&gt;
      &lt;name&gt;Osnabrück Opencast Repository&lt;/name&gt;
      &lt;url&gt;https://nexus.opencast.org/nexus/content/groups/public&lt;/url&gt;
      &lt;mirrorOf&gt;opencast&lt;/mirrorOf&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;
&lt;/settings&gt;
</code></pre>

<p>This example would add a mirror for the primary Opencast Maven repository, causing the Osnabrück repository to be the
preferred repository to use. You can find some example configurations in <code>docs/maven/</code>.</p>
<h2 id="pushing-artifacts-to-maven">Pushing artifacts to Maven</h2>
<h4 id="pushing-to-your-local-maven-repository">Pushing to your local Maven repository</h4>
<p>The following command will add a file to your local Maven repository.  This is useful for testing if your artifacts are
correctly placed prior to pushing to the mainline Nexus repository.</p>
<pre><code>mvn install:install-file \
 -Dfile=$filename \
 -DgroupId=$groupId \
 -DartifactId=$artifactId \
 -Dpackaging=$packaging \
 -Dversion=$version \
 -DgeneratePom=$generatePom
</code></pre>
<p>Variable Map</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>What it does</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>The path to the local file you want in your repository</td>
<td>audio.mp2</td>
</tr>
<tr>
<td>groupId</td>
<td>The Opencast group ID</td>
<td>org.opencastproject</td>
</tr>
<tr>
<td>artifactId</td>
<td>The artifact ID. This is the name of the artifact according to Maven</td>
<td>audio</td>
</tr>
<tr>
<td>packaging</td>
<td>The file type (effectively), this should match the filename's extension</td>
<td>mp2</td>
</tr>
<tr>
<td>version</td>
<td>The artifact's version</td>
<td>1.1</td>
</tr>
<tr>
<td>generatePom</td>
<td>Whether or not to generate a pom file automatically</td>
<td>true</td>
</tr>
</tbody>
</table>
<h4 id="pushing-to-the-remote-nexus-repository">Pushing to the remote Nexus repository</h4>
<p>The following command will push a file to the remote Nexus repository.  Normally builds are pushed to to the remote
automatically as part of the CI server build, however if there is a need to push to the repo this is the command you
need. To deploy to the remote repository you will first need a username and password. This can be obtained from the QA
coordinator. Once you have that, put them in your <code>.m2/settings.xml</code> file. It should look like this</p>
<pre><code>&lt;settings&gt;
  &lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;opencast&lt;/id&gt;
      &lt;username&gt;$username&lt;/username&gt;
      &lt;password&gt;$password&lt;/password&gt;
    &lt;/server&gt;
    ...
  &lt;/servers&gt;
  ....
&lt;/settings&gt;
</code></pre>
<p>The command to push the file looks like this. Not that pushing files from your local Maven repository directly is not
possible, instead you must copy them <em>outside</em> the repository and push from there. See below for help on that.</p>
<pre><code>mvn deploy:deploy-file \
  -DrepositoryId=$repo_id \
  -Durl=$url \
  -Dfile=$filename \
  -DgroupId=$groupId \
  -DartifactId=$artifactId \
  -Dpackaging=$packaging \
  -Dversion=$version \
  -DgeneratePom=$generatePom
</code></pre>
<p>Variable Map</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>What it does</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>repo_id</td>
<td>Identifies which set of credentials from your .m2/settings.xml file to use</td>
<td>opencast</td>
</tr>
<tr>
<td>url</td>
<td>Where to push the file</td>
<td>http://nexus.virtuos.uos.de:8081/nexus/content/repositories/snapshots</td>
</tr>
<tr>
<td>filename</td>
<td>The path to the local file you want in your repository</td>
<td>audio_out.mp2</td>
</tr>
<tr>
<td>groupId</td>
<td>The Opencast group ID</td>
<td>org.opencastproject</td>
</tr>
<tr>
<td>artifactId</td>
<td>The artifact ID. This is the name of the artifact according to Maven</td>
<td>audio</td>
</tr>
<tr>
<td>packaging</td>
<td>The file type (effectively), this should match the filename's extension</td>
<td>mp2</td>
</tr>
<tr>
<td>version</td>
<td>The artifact's version</td>
<td>1.1</td>
</tr>
<tr>
<td>generatePom</td>
<td>Whether or not to generate a pom file automatically</td>
<td>true</td>
</tr>
</tbody>
</table>
<h4 id="help-with-push-to-the-remote-nexus-repository">Help with push to the remote Nexus repository</h4>
<p>Uploading to Nexus is more difficult than it should be: You can't just run deploy:deploy-file. This script is handy
when you need to manually upload something like a previous release.  Make a copy of
<code>~/.m2/repository/org/opencastproject/*</code> to <code>$SOURCE_FILES</code> inside of your git clone, check out the version you're
uploading, then run this script.  There will be numerous errors as it processes things that either don't have
artifacts, or don't have artifacts in the version you're uploading, but those can be ignored.</p>
<pre><code>#!/bin/bash

CORE_NEXUS="nexus.virtuos.uos.de:8081"
SOURCE_FILES="nexus_copy"

uploadVersion() {
  ls $1 | while read line
  do
    mvn deploy:deploy-file \
      -DrepositoryId=opencast \
      -Durl=http://$CORE_NEXUS/nexus/content/repositories/releases \
      -Dfile=$SOURCE_FILES/$line/$2/$line-$2.jar \
      -DgroupId=org.opencastproject -DartifactId=$line \
      -Dversion=$2 \
      -DgeneratePom=true \
      -Dpackaging=jar
  done
}

git checkout &lt;VERSION&gt;
uploadVersion ~/.m2/repository/org/opencastproject &lt;VERSION&gt;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../api/" class="btn btn-neutral float-right" title="Introduction">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../notes/" class="btn btn-neutral" title="Notes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opencast/opencast/tree/develop/docs/guides/developer/docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../notes/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../api/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
