<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Maven Repository - Opencast - Developer Guide</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/font-awesome.min.css" rel="stylesheet">
  <link href="../../css/style-guide.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Maven Repository";
    var mkdocs_page_input_path = "infrastructure/maven-repository.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Opencast - Developer Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development Process</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../installation/source-linux/">Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../development-process/">Development</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reviewing-and-merging/">Reviewing, Merging and Declining Pull Requests</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release-manager/">Release Manager</a>
                </li>
                <li class="">
                    
    <a class="" href="../../qa-coordinator/">QA Coordinator</a>
                </li>
                <li class="">
                    
    <a class="" href="../../security/">Security Issues</a>
                </li>
                <li class="">
                    
    <a class="" href="../../code-style/">Code Style</a>
                </li>
                <li class="">
                    
    <a class="" href="../../documentation/">Documentation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Decision Making</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../decision-making/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/lazy-consensus/">Lazy Consensus</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/consensus-building/">Consensus Building</a>
                </li>
                <li class="">
                    
    <a class="" href="../../decision-making/voting/">Voting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development Environment</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../development-environment/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../development-environment-docker/">With Docker</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../committer/">Committers</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../license/">Licenses and Legal Matters</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../governance/">Governance</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../localization/">Localization</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../packaging/">Packaging</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../proposal-log/">Proposal Log</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../asset-manager/">Asset Manager</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../scheduler/">Scheduler</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Modules</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../modules/">Overview</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Administrative user Interface</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/admin-ui/development/">Development</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Style Guide</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/">Overview</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/color-palette/">Color Palette</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/typeface/">Typeface</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/view-structure/">View Structure</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/spacing/">Logo</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/navigation/">Navigation</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/modals/">Modals</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/forms/">Forms</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/icons/">Icons</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/buttons/">Buttons</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/dropdowns/">Dropdowns</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/alerts-indicators/">Alerts and Indicators</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../../modules/admin-ui/style/references/">References</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Capture Agent</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/capture-agent/capture-agent/">Capture Agent</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/capture-agent/testcases/">Test Cases</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Player</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/architecture/">Architecture</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/core.reference/">Core Reference</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/events/">Events</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/storage/">Storage</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/plugin.development/">Plugin Development</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player/testing/">Testing</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/stream-security/">Stream Security</a>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/oaipmh/">OAI-PMH</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Infrastructure</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../notes/">Notes</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Maven Repository</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#opencast-maven-repository">Opencast Maven Repository</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#adding-libraries-to-the-repository">Adding Libraries To The Repository</a></li>
        
            <li><a class="toctree-l4" href="#setting-up-another-maven-repository">Setting-up Another Maven Repository</a></li>
        
            <li><a class="toctree-l4" href="#prefer-a-specific-repository">Prefer a Specific Repository</a></li>
        
            <li><a class="toctree-l4" href="#pushing-artifacts-to-a-maven-repository">Pushing artifacts to a Maven repository</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">External API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/usage/">Usage</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/authentication/">Authentication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/authorization/">Authorization</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/base-api/">Base API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/agents-api/">Agents API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/events-api/">Events API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/series-api/">Series API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/groups-api/">Groups API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/security-api/">Security API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/workflow-api/">Workflow API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/types/">Data Types</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/glossary/">Glossary</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Opencast - Developer Guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Infrastructure &raquo;</li>
        
      
    
    <li>Maven Repository</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opencast/opencast/edit/develop/docs/guides/developer/docs/infrastructure/maven-repository.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="opencast-maven-repository">Opencast Maven Repository</h1>
<p>The Maven repository server maintains a copy of all the Java dependencies used by Opencast.</p>
<h2 id="adding-libraries-to-the-repository">Adding Libraries To The Repository</h2>
<ol>
<li>Login as an administrator on the <a href="https://nexus.opencast.org">Opencast Nexus Master</a></li>
<li>Select repository</li>
<li>Select the artifact upload tab</li>
<li>Fill in the details and upload the file</li>
</ol>
<h2 id="setting-up-another-maven-repository">Setting-up Another Maven Repository</h2>
<p>Having a repository server run in your local network can significantly improve the speed artifacts are retrieved while
building Opencast.</p>
<h3 id="docker">Docker</h3>
<p>There is a preconfigured Docker image for a Nexus server set-up for Opencast. To run an Opencast Nexus using Docker,
follow these steps:</p>
<pre><code>docker run \
    --name mvncache \
    -p 8000:8000 \
    docker.io/lkiesow/opencast-maven-repository
</code></pre>
<ul>
<li>The <code>-p</code> option will map the internal port of the server in Docker to the port on the host machine.</li>
</ul>
<h2 id="prefer-a-specific-repository">Prefer a Specific Repository</h2>
<p>If you did set-up a local repository or just want to select a specific global repository by default, you can use a
custom Maven configuration. To do that, create asettings file in <code>~/.m2/settings.xml</code> like this:</p>
<pre><code class="xml">&lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0
  http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt;
  &lt;mirrors&gt;
    &lt;mirror&gt;
      &lt;id&gt;opencast-osna&lt;/id&gt;
      &lt;name&gt;Osnabrück Opencast Repository&lt;/name&gt;
      &lt;url&gt;https://nexus.opencast.org/nexus/content/groups/public&lt;/url&gt;
      &lt;mirrorOf&gt;opencast&lt;/mirrorOf&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;
&lt;/settings&gt;
</code></pre>

<p>This example would add a mirror for the primary Opencast Maven repository, causing the Osnabrück repository to be the
preferred repository to use. You can find some example configurations in <code>docs/maven/</code>.</p>
<h2 id="pushing-artifacts-to-a-maven-repository">Pushing artifacts to a Maven repository</h2>
<h4 id="pushing-to-your-local-maven-repository">Pushing to your local Maven repository</h4>
<p>The following command will add a file to your local Maven repository.  This is useful for testing if your artifacts are
correctly placed prior to pushing to the mainline Nexus repository.</p>
<pre><code>mvn install:install-file \
 -Dfile=$filename \
 -DgroupId=$groupId \
 -DartifactId=$artifactId \
 -Dpackaging=$packaging \
 -Dversion=$version \
 -DgeneratePom=$generatePom
</code></pre>
<p>Variable Map</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>What it does</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>The path to the local file you want in your repository</td>
<td>audio.mp2</td>
</tr>
<tr>
<td>groupId</td>
<td>The Opencast group ID</td>
<td>org.opencastproject</td>
</tr>
<tr>
<td>artifactId</td>
<td>The artifact ID. This is the name of the artifact according to Maven</td>
<td>audio</td>
</tr>
<tr>
<td>packaging</td>
<td>The file type (effectively), this should match the filename's extension</td>
<td>mp2</td>
</tr>
<tr>
<td>version</td>
<td>The artifact's version</td>
<td>1.1</td>
</tr>
<tr>
<td>generatePom</td>
<td>Whether or not to generate a pom file automatically</td>
<td>true</td>
</tr>
</tbody>
</table>
<h4 id="pushing-to-maven-central">Pushing to Maven Central</h4>
<p>Opencast previously hosted our own Maven repository at nexus.opencast.org, however starting with Opencast 6.6 we are
transitioning to using Maven Central.  There are a few steps prior to being able to push to Sonatype's repo:</p>
<ul>
<li>Create a GPG key, and push the public key to a key server</li>
<li>Sign up for an account on <a href="https://issues.sonatype.org">Sonatype's JIRA instance</a></li>
<li>Let the QA Coordinator know about your user, they will comment on
  <a href="https://issues.sonatype.org/browse/OSSRH-36510">our repo creation ticket</a> or create a new issue to give your user permissions</li>
<li>Put the following in your <code>.m2/settings.xml</code> file</li>
</ul>
<pre><code class="xml">    &lt;settings&gt;
      &lt;servers&gt;
        &lt;server&gt;
          &lt;id&gt;ossrh&lt;/id&gt;
          &lt;username&gt;$username&lt;/username&gt;
          &lt;password&gt;$password&lt;/password&gt;
        &lt;/server&gt;
        ...
      &lt;/servers&gt;
      &lt;profiles&gt;
        &lt;profile&gt;
          &lt;id&gt;ossrh&lt;/id&gt;
          &lt;activation&gt;
            &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
          &lt;/activation&gt;
          &lt;properties&gt;
            &lt;gpg.keyname&gt;$gpgKeyId&lt;/gpg.keyname&gt;
          &lt;/properties&gt;
        &lt;/profile&gt;
        ...
      &lt;/profiles&gt;
    &lt;/settings&gt;
</code></pre>

<h5 id="pushing-snapshots">Pushing Snapshots</h5>
<p>Snapshots are pushed automatically by the CI servers.  For historical purposes, this is accomplished by:</p>
<pre><code class="bash">mvn deploy
</code></pre>

<p>To verify, your artifacts can be found <a href="https://oss.sonatype.org/content/repositories/snapshots/org/opencastproject/">here</a>
and <a href="https://oss.sonatype.org/content/groups/staging/org/opencastproject/">here</a>.  Note that you cannot (easily) drop
bad snapshots.  Instead, fix it and redeploy!</p>
<h5 id="pushing-releases">Pushing Releases</h5>
<p>Note: Please read this section entirely before running any commands.  Maven Central does not allow you to change a
release once it has been closed!</p>
<p>Pushing releases is similar to snapshots, with the added requirements that you also push:</p>
<ul>
<li>Javadocs</li>
<li>Sources</li>
<li>GPG signatures for the binaries, docs, and sources</li>
</ul>
<p>This is automated with the <code>release</code> profile.  To push a release run</p>
<pre><code class="bash">mvn nexus-staging:deploy -P release
</code></pre>

<p>This creates a staging repository (https://oss.sonatype.org/content/groups/staging/org/opencastproject/) for your
artifacts.  This is always safe to do - you can still rollback all changes with</p>
<pre><code class="bash">mvn nexus-staging:drop
</code></pre>

<p>If things do not look ok, fix the issue and redeploy.  Once you are confident that everything is ok, you can run</p>
<pre><code class="bash">mvn nexus-staging:close
</code></pre>

<p>This closes the staging repository, and runs the Sonatype-side tests for things like GPG signatures.  If this fails,
correct the issue locally, and redeploy.  Once this succeeds, you have two options: drop (to destroy the release) or:</p>
<pre><code class="bash">mvn nexus-staging:release
</code></pre>

<p>to permanently release the binaries in their current states.</p>
<h5 id="troubleshooting">Troubleshooting</h5>
<p>Sometimes the deploy or close will fail, timing out after 5 minutes waiting for Sonatype.  It will complain about
violations of deploy rules - this may or may not actually be true.  If you're confident that this is caused by a simple
timeout and not something you have done use one of the following.</p>
<p>To reattempt a deploy use</p>
<pre><code class="bash">mvn nexus-staging:deploy-staged
</code></pre>

<p>This will avoid recompiling, retesting, and resigning all of the binaries.</p>
<p>To reattempt a close use</p>
<pre><code class="bash">mvn nexus-staging:close
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../api/" class="btn btn-neutral float-right" title="Introduction">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../notes/" class="btn btn-neutral" title="Notes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opencast/opencast/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../notes/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../api/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
