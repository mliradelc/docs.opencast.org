<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Encoding - Opencast - Administration Guide</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Encoding";
    var mkdocs_page_input_path = "configuration/encoding.md";
    var mkdocs_page_url = "/configuration/encoding/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Opencast - Administration Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../release.notes/">Release Notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../installation/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation/multiple-servers/">Multiple Servers</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Installation from Source</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../installation/source-debian-ubuntu/">Debian/Ubuntu</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../installation/source-rhel-sl-centos/">RHEL/CentOS</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../installation/source-macosx/">MacOS X</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Installation from Package (RPM)</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../installation/rpm-fedora/">Fedora</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../installation/rpm-rhel-sl-centos/">RHEL/CentOS</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Configuration</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../basic/">Basic</a>
                </li>
                <li class="">
                    
    <a class="" href="../database/">Database</a>
                </li>
                <li class="">
                    
    <a class="" href="../message-broker/">Message Broker</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Encoding</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#encoding-profile-configuration">Encoding Profile Configuration</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#default-profiles-and-possible-settings">Default Profiles and Possible Settings</a></li>
        
            <li><a class="toctree-l4" href="#create-an-encoding-profile">Create an Encoding Profile</a></li>
        
            <li><a class="toctree-l4" href="#using-a-profile">Using a Profile</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../logging.and.privacy/">Logging and Privacy</a>
                </li>
                <li class="">
                    
    <a class="" href="../multi.tenancy/">Multi Tenancy</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Security</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../security/">General Security</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../security.cas/">Central Authentication Service (CAS)</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../security.ldap/">LDAP Authentication and Authorization (without CAS)</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../workflow/">Workflow</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Modules</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../modules/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/mediamodule.configuration/">Media Module</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Player</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.architecture/">Architecture</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.configuration/">Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.core.reference/">Core Reference</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.events/">Events</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.storage/">Storage</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.plugins/">Plugins</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.plugin.development/">Plugin Development</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.testing/">Testing</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.configuration/">Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/player.url.parameter/">URL Parameters</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/searchindex/">Search Index</a>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/textextraction/">Text Extraction</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Video Editor</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/videoeditor.manual/">Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/videoeditor.setup/">Setup</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../modules/videoeditor.architecture/">Architecture</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/videosegmentation/">Video Segmentation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../modules/youtubepublication/">YouTube Publication</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Workflow Operation Handler</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/analyzeaudio-woh/">Analyze Audio</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/append-woh/">Append</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/archive-woh/">Archive</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/caption-woh/">Caption</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/compose-woh/">Compose</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/composite-woh/">Composite</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/concat-woh/">Concat</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/coverimage-woh/">Cover Image</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/defaults-woh/">Defaults</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/editor-woh/">Editor</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/email-woh/">Email</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/extracttext-woh/">Extract Text</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/httpnotify-woh/">HTTP Notify</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/image-woh/">Image</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/imagetovideo-woh/">Image to Video</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/incident-woh/">Incident</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/ingestdownload-woh/">Ingest-Download</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/inspect-woh/">Inspect</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/normalizeaudio-woh/">Normalize Audio</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/postmediapackage-woh/">Post Media Package</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/prepareav-woh/">Prepare A/V</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/publishengage-woh/">Publish Engage</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/republish-woh/">Republish</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/segmentpreviews-woh/">Segment Previews</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/segmentvideo-woh/">Segment Video</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/series-woh/">Series</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/silence-woh/">Silence</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/tag-woh/">Tag</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/trim-woh/">Trim</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/waveform-woh/">Waveform</a>
                </li>
                <li class="">
                    
    <a class="" href="../../workflowoperationhandlers/zip-woh/">Zip</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Opencast - Administration Guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Configuration &raquo;</li>
        
      
    
    <li>Encoding</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://bitbucket.org/opencast-community/matterhorn/src/develop/docs/guides/admin/docs/src/default/docs/configuration/encoding.md"
          class="icon icon-bitbucket"
        > Edit on Bitbucket</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="encoding-profile-configuration">Encoding Profile Configuration</h1>
<p>A workflow defines which operations are applied to media ingested into Opencast and the order of these operations. An
operation can be something general like “encode this video”. The encoding profiles then specify exactly how a media is
ancoded, which filters are applied, which codecs are used and in which container these will be stored, …</p>
<p>Opencast comes with a set of such profiles generating files for both online playback and download. These profiles are
build to work for everyone, meaning that in most cases optimization can be done according to local needs. So modifying
these profiles or building new ones often makes sense. This document will help you modify or augment Opencast's
default encoding profiles for audio, video and still images.</p>
<h2 id="default-profiles-and-possible-settings">Default Profiles and Possible Settings</h2>
<p>This section contains some notes about the default profiles, explaining some thoughts behind those profiles and pointing
at things you might want to change depending on your local set-up.</p>
<h3 id="av-muxing-from-lossless-to-safe">A/V-Muxing: From lossless to safe</h3>
<p>The audio/video muxing (profile.mux-av.work) is applied if audio and video are send to Opencast separately. The basic
idea behind this is, to combine these separate files into one file which can later be converted in one step.</p>
<p>Possible settings:</p>
<ul>
<li>If you get an audio and a video file separately, it is possivle to just copy the streams and put them together into a
   new file. This is very fast (you only have to copy the streams) and most importantly, it is lossless, as no
   re-encoding is done. The question is: What a/v container format can/should you use for such an operation.</li>
<li>You can try to use the video container the input video came in and just add the audio. This means that you will never
   have an unexpected video container you don't know of. I.e. if you put an .mp4 video in, it still uses and .mp4
   container after musing, etc. This might, however, lead to problems if you throw in an audio file that cannot be muxen
   in the specific container format (i.e. you have a FLAC audio file and an FLV container). This is, what Opencast
   does at the moment.</li>
<li>To circumvent the container problem, we could also use a container format which can hold almost everything (i.e. mkv)
   regardless of the input. This would mean that MH can handle more combinations of a/v streams but you will always end
   up with a Matroska file after muxing. Of cause you can then encode it to mp4, etc. later on.</li>
</ul>
<p>The safest option for muxing is, of cause, to always re-encode the streams. It is far slower. It always means a quality
loss. But it can handle everything FFmpeg can handle which (dependin on your FFmpeg configuration) is quite a lot.</p>
<h3 id="trimming-fast-and-lossless-vs-accurate">Trimming: Fast and lossless VS accurate</h3>
<p>The profile trim.work is used after you send your recording to trim/hold and selected new start and end points. Here you
have basically two choices:</p>
<ul>
<li>As you only want to cut the video, you don't have to re-encode all of it. You just split the stream and put it into a
   new file. This is fast. This is lossless. But depending on the video format this might not be accurate. You can only
   cut a stream at an I-frame (a frame holding the full image). Doing this, FFmpeg will cut the video at the nearest
   I-frame before the selected position meaning that you might end up with a bit more video than you thought you would
   get. You can minimize this by making sure that the input video has a high I-frame frequency (probably a good idea
   anyway). This is what Opencast does at the moment.</li>
<li>The alternative is to cut between two I-frames. This is possible, but requires the video to be re-encoded completely.
   This means that you will spend a lot of time on this process and will always loose quality.</li>
</ul>
<h2 id="create-an-encoding-profile">Create an Encoding Profile</h2>
<p>This section will help you to understand how you can modify an existing profile or create a completly new one.</p>
<p>Creating a new encoding profile is a matter of creating a configuration file and placing it in the encoding profiles
watch folder.</p>
<h3 id="encoding-profile-folder">Encoding Profile Folder</h3>
<p>The <code>&lt;config_dir&gt;/encoding</code> folder allows you to quickly augment Opencast's existing behavior, simply by modifying or
adding new configuration files. The file names should follow the pattern <code>*.properties</code>.</p>
<h3 id="the-encoding-profile">The Encoding Profile</h3>
<p>Encoding profiles consist of a set of key-value pairs that conform to the following pattern:</p>
<pre><code>profile.&lt;name&gt;.&lt;context&gt;.&lt;property&gt; = &lt;value&gt;
</code></pre>
<p>For example:</p>
<pre><code>profile.flash.http.name = flash download
</code></pre>
<p>All profiles should have the following properties:</p>
<pre><code>.name
.input  = [audio|visual|stream|image]
.output = [audio|visual|stream|image]
.suffix
.mimetype
.ffmpeg.command
</code></pre>
<p>For example:</p>
<pre><code>// My audio/video encoding profile
profile.my-av-profile.http.name           = my audio/video encoding profile
profile.my-av-profile.http.input          = visual
profile.my-av-profile.http.output         = visual
profile.my-av-profile.http.suffix         = -encoded.enc
profile.my-av-profile.http.mimetype       = video/x-enc
profile.my-av-profile.http.ffmpeg.command = -i #{in.video.path} -c:v venc -c:a aenc #{out.dir}/#{out.name}#{out.suffix}
</code></pre>
<p>The most important part of this profile is the <code>ffmpeg.command</code>. This line specifies FFmpeg command line options using
<code>#{expression}</code> for string replacement.</p>
<h3 id="ffmpeg">FFmpeg</h3>
<p>To create a new profile you have basically one task to do: Find an appropriate FFmpeg command line for whatever you want
to do. For more information about FFmpeg, its options and how you can build FFmpeg with additional functionality have a
look at the <a href="http://trac.ffmpeg.org/wiki">Official FFmpeg Wiki</a>. For trying out new encoding settings, just call FFmpeg
from the command line.</p>
<h2 id="using-a-profile">Using a Profile</h2>
<p>Once defined, use your encoding profile in your workflow by setting the encoding-profile property to the profiles name:</p>
<pre><code>&lt;operation
    id="compose"
    fail-on-error="true"
    exception-handler-workflow="error"
    description="Encode presenter using my audio/video encoding profile"&gt;
  &lt;configurations&gt;
    &lt;configuration key="source-flavor"&gt;presenter/work&lt;/configuration&gt;
    &lt;configuration key="target-flavor"&gt;presenter/delivery&lt;/configuration&gt;
    &lt;configuration key="target-tags"&gt;rss, atom, captioning&lt;/configuration&gt;
    &lt;configuration key="encoding-profile"&gt;my-av-profile.http&lt;/configuration&gt;
  &lt;/configuration&gt;
&lt;/operation&gt;
</code></pre>
<p>Have a look at the Workflow Configuration section for more details about this.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../logging.and.privacy/" class="btn btn-neutral float-right" title="Logging and Privacy">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../message-broker/" class="btn btn-neutral" title="Message Broker"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://bitbucket.org/opencast-community/matterhorn/src/develop/docs/guides/admin/docs" class="icon icon-bitbucket" style="float: left; color: #fcfcfc"> BitBucket</a>
      
      
        <span><a href="../message-broker/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../logging.and.privacy/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
